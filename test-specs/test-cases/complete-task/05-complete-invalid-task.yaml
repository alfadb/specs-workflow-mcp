# 测试用例：完成无效的任务号
name: "完成无效的任务号"
description: "测试尝试完成一个不存在的任务号"
category: "complete-task"
priority: "high"

setup:
  fixtures: "fixtures/complete-task/tasks-stage"
  target: "./e2e-test-complete-invalid"

request:
  method: "tools/call"
  params:
    name: "specs-workflow"
    arguments:
      path: "./e2e-test-complete-invalid"
      action:
        type: "complete_task"
        taskNumber: "99"

expect:
  operation: "complete_task"
  error: true  # 期望错误响应
  error_checks:
    - type: "error_message"
      contains: "not found"
      description: "错误信息应该提到任务未找到"
  additional_checks:
    # 验证错误不产生副作用（确保文件未被修改）
    - type: "file_content"
      path: "./e2e-test-complete-invalid/tasks.md"
      contains: "[ ] 1.1. 创建测试环境配置系统"
      description: "任务 1.1 应该保持未完成状态"
    - type: "file_content"
      path: "./e2e-test-complete-invalid/tasks.md"
      contains: "[ ] 1.2. 实现 MCP 连接管理器"
      description: "任务 1.2 应该保持未完成状态"
    - type: "file_content"
      path: "./e2e-test-complete-invalid/tasks.md"
      contains: "[ ] 2. **测试装置生成器开发**"
      description: "任务 2 应该保持未完成状态"

cleanup: ["./e2e-test-complete-invalid"]