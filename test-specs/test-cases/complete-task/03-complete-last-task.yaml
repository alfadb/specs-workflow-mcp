# 测试用例：完成最后一个任务
name: "完成最后一个任务"
description: "测试完成任务列表中的最后一个任务，完成整个工作流"
category: "complete-task"
priority: "high"

setup:
  fixtures: "fixtures/complete-task/almost-done"
  target: "./e2e-test-complete-last"

request:
  method: "tools/call"
  params:
    name: "specs-workflow"
    arguments:
      path: "./e2e-test-complete-last"
      action:
        type: "complete_task"
        taskNumber: ["6.2"]

expect:
  operation: "complete_task"
  # JSON Schema 验证会自动验证结构是否符合 OpenAPI 规范
  additional_checks:
    - type: "array_equals"

      path: "structuredContent.completedTasks"

      values: ["6.2"]

      description: "任务号应该是 6.2"

    

    - type: "value_equals"

      path: "structuredContent.success"

      value: true

      description: "批量操作应该成功"
    # 完成 6.2 后，由于 6.1 已完成，父任务 6 会自动标记完成
    # 所以所有任务都完成了，没有下一个任务
    - type: "value_equals"
      path: "structuredContent.hasNextTask"
      value: false
      description: "所有任务都已完成，没有下一个任务"
    - type: "value_contains"
      path: "structuredContent.displayText"
      contains: "- 6.2"
      description: "显示文本应该包含任务完成信息"
    - type: "value_contains"
      path: "structuredContent.displayText"
      contains: "All tasks completed"
      description: "显示文本应该包含所有任务完成的信息"

cleanup: ["./e2e-test-complete-last"]