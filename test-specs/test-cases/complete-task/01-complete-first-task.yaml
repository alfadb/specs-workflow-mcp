# 测试用例：完成第一个任务
name: "完成第一个任务"
description: "测试完成任务列表中的第一个任务"
category: "complete-task"
priority: "high"

setup:
  fixtures: "fixtures/complete-task/tasks-stage"
  target: "./e2e-test-complete-first"

request:
  method: "tools/call"
  params:
    name: "specs-workflow"
    arguments:
      path: "./e2e-test-complete-first"
      action:
        type: "complete_task"
        taskNumber: "1.1"

expect:
  operation: "complete_task"
  # JSON Schema 验证会自动验证结构是否符合 OpenAPI 规范
  additional_checks:
    - type: "value_equals"
      path: "structuredContent.taskCompleted"
      value: "1.1"
      description: "任务号应该是 1.1"
    - type: "value_equals"
      path: "structuredContent.hasNextTask"
      value: true
      description: "应该有下一个任务"
    - type: "file_content"
      path: "./e2e-test-complete-first/tasks.md"
      contains: "[x] 1.1. 创建测试环境配置系统"
      description: "任务文件中第 1.1 个任务应该被标记为完成"
    - type: "value_equals"
      path: "structuredContent.nextTask.number"
      value: "1"
      description: "下一个任务应该是任务 1（主任务仍未完成）"

cleanup: ["./e2e-test-complete-first"]