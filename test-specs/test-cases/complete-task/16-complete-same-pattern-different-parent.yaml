# 测试用例：相同编号模式的子任务隔离
name: "相同编号模式的子任务隔离"
description: "验证完成 5.1 不会影响 1.1、2.1、3.1、4.1、6.1 等具有相同子编号的任务"
category: "complete-task"
priority: "critical"

setup:
  fixtures: "fixtures/complete-task/tasks-stage"
  target: "./e2e-test-same-pattern-isolation"

request:
  method: "tools/call"
  params:
    name: "specs-workflow"
    arguments:
      path: "./e2e-test-same-pattern-isolation"
      action:
        type: "complete_task"
        taskNumber: "5.1"

expect:
  operation: "complete_task"
  additional_checks:
    - type: "value_equals"
      path: "structuredContent.taskCompleted"
      value: "5.1"
      description: "完成的任务应该是 5.1"
    
    # 验证 5.1 被标记为完成
    - type: "file_content"
      path: "./e2e-test-same-pattern-isolation/tasks.md"
      contains: "[x] 5.1. 并行测试执行"
      description: "任务 5.1 应该被标记为完成"
    
    # 验证所有其他 x.1 格式的任务都未受影响
    - type: "file_content"
      path: "./e2e-test-same-pattern-isolation/tasks.md"
      contains: "[ ] 1.1. 创建测试环境配置系统"
      description: "任务 1.1 应该保持未完成状态"
    
    - type: "file_content"
      path: "./e2e-test-same-pattern-isolation/tasks.md"
      contains: "[ ] 2.1. 实现基础装置生成功能"
      description: "任务 2.1 应该保持未完成状态"
    
    - type: "file_content"
      path: "./e2e-test-same-pattern-isolation/tasks.md"
      contains: "[ ] 3.1. init 操作测试套件"
      description: "任务 3.1 应该保持未完成状态"
    
    - type: "file_content"
      path: "./e2e-test-same-pattern-isolation/tasks.md"
      contains: "[ ] 4.1. 完整工作流测试"
      description: "任务 4.1 应该保持未完成状态"
    
    - type: "file_content"
      path: "./e2e-test-same-pattern-isolation/tasks.md"
      contains: "[ ] 6.1. 详细测试报告生成"
      description: "任务 6.1 应该保持未完成状态"
    
    # 验证 5.2 也未受影响
    - type: "file_content"
      path: "./e2e-test-same-pattern-isolation/tasks.md"
      contains: "[ ] 5.2. 测试重试机制"
      description: "同组的任务 5.2 应该保持未完成状态"

cleanup: ["./e2e-test-same-pattern-isolation"]