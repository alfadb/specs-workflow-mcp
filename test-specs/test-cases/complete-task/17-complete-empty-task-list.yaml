# 测试用例：空任务列表场景
name: "空任务列表完成任务"
description: "验证当任务列表为空（所有任务已完成）时尝试完成任务的行为"
category: "complete-task"
priority: "high"

setup:
  fixtures: "fixtures/complete-task/all-done"
  target: "./e2e-test-empty-task-list"

request:
  method: "tools/call"
  params:
    name: "specs-workflow"
    arguments:
      path: "./e2e-test-empty-task-list"
      action:
        type: "complete_task"
        taskNumber: ["1"]

expect:
  operation: "complete_task"
  additional_checks:
    - type: "value_equals"
      path: "isError"
      value: false
      description: "应该返回成功（幂等性）"
    
    - type: "value_contains"
      path: "content[0].text"
      contains: "already completed"
      description: "信息应该提到任务已经完成"
    
    - type: "array_equals"
      path: "structuredContent.alreadyCompleted"
      values: ["1"]
      description: "任务应该在已完成列表中"

    - type: "value_equals"
      path: "structuredContent.success"
      value: true
      description: "批量操作应该成功"

    - type: "value_equals"
      path: "structuredContent.hasNextTask"
      value: false
      description: "不应该有下一个任务（所有任务已完成）"

cleanup: ["./e2e-test-empty-task-list"]